(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7ec2"],{"0fry":function(t,e,i){"use strict";i.d(e,"a",function(){return n}),i.d(e,"b",function(){return r}),i.d(e,"d",function(){return o}),i.d(e,"c",function(){return l});var a=i("t3Un");function n(t){return Object(a.a)({url:"/api/prizes/",method:"post",data:t})}function r(t){return Object(a.a)({url:"/api/prizes/"+t+"/",method:"delete"})}function o(t,e){return Object(a.a)({url:"/api/prizes/"+t+"/",method:"patch",data:e})}function l(){return Object(a.a)({url:"/api/prizes/?type=category"})}},PHaF:function(t,e,i){},dciG:function(t,e,i){"use strict";var a=i("PHaF");i.n(a).a},ip1P:function(t,e,i){"use strict";i.r(e);var a=i("P2sY"),n=i.n(a),r=i("0fry"),o={name:"Prize",filters:{toPer:function(t){if(0===t)return 0;var e=Number(100*t).toFixed(2);return e+="%"}},data:function(){return{category:[],Data:!0,tabName:void 0,prizes:null,prizeLoading:!0,titleMap:{addPrize:"新增礼品",editPrize:"编辑礼品"},dialogStatus:"",dialogFormVisible:!1,form:{grade:"",code:"",prize_name:"",probability:""}}},created:function(){this.fetchPrizes()},methods:{totalProb:function(t){var e=0;return t.forEach(function(t,i,a){e+=parseFloat(t.probability)}),e},querySearch:function(t,e){Object(r.c)().then(function(t){0===t.data.length?e([{value:"默认"}]):e(t.data.map(function(t){return{value:t.name}}))})},fetchPrizes:function(){var t=this;this.prizeLoading=!0,Object(r.c)().then(function(e){t.category=e.data,0!==e.data.length?(t.Data=!0,"0"!==t.tabName&&-1!==e.data.map(function(t){return t.name}).indexOf(t.tabName)||(t.tabName=e.data[0].name)):t.Data=!1}),this.prizeLoading=!1},addPrize:function(){this.dialogFormVisible=!0,this.dialogStatus="addPrize",this.form={grade:"",code:"",prize_name:"",probability:""}},deletePrize:function(t){var e=this;Object(r.b)(t.id).then(function(){e.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}),e.fetchPrizes()})},editPrize:function(t){this.form=n()({},t),this.dialogFormVisible=!0,this.dialogStatus="editPrize"},dialogConfirm:function(){var t=this;if("editPrize"===this.dialogStatus){var e=n()({},this.form);Object(r.d)(e.id,e).then(function(){t.fetchPrizes(),t.dialogFormVisible=!1,t.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3})})}else Object(r.a)(this.form).then(function(e){t.fetchPrizes(),t.dialogFormVisible=!1,t.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})})}}},l=(i("dciG"),i("KHd+")),c=Object(l.a)(o,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("el-button",{attrs:{type:"success"},on:{click:t.addPrize}},[t._v("添加礼品")]),t._v(" "),t.Data?i("el-tabs",{staticStyle:{"margin-top":"20px"},attrs:{type:"border-card"},model:{value:t.tabName,callback:function(e){t.tabName=e},expression:"tabName"}},t._l(t.category,function(e){return i("el-tab-pane",{key:e.name,attrs:{label:e.name,name:e.name}},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.prizeLoading,expression:"prizeLoading"}],staticStyle:{"margin-top":"20px"},attrs:{data:e.prizes,"element-loading-text":"获取中",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",label:"礼品编号","min-width":"12.5%"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.code)+"\n          ")]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"礼品名称","min-width":"37.5%"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.prize_name)+"\n          ")]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"中奖权重","min-width":"12.5%"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.probability)+"\n          ")]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"中奖率","min-width":"12.5%",align:"center"},scopedSlots:t._u([{key:"default",fn:function(i){return[t._v("\n            "+t._s(t._f("toPer")(i.row.probability/t.totalProb(e.prizes)))+"\n          ")]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作","min-width":"25%"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"primary"},on:{click:function(i){t.editPrize(e.row)}}},[t._v("编辑")]),t._v(" "),i("el-button",{attrs:{type:"danger"},on:{click:function(i){t.deletePrize(e.row)}}},[t._v("删除")])]}}])})],1)],1)})):i("div",{staticStyle:{"margin-top":"20px"}},[t._v("暂无数据")]),t._v(" "),i("el-dialog",{attrs:{title:t.titleMap[t.dialogStatus],visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("el-form",{attrs:{model:t.form}},[i("el-form-item",{attrs:{label:"分组"}},[i("el-autocomplete",{attrs:{"fetch-suggestions":t.querySearch,placeholder:"请输入分组"},model:{value:t.form.grade,callback:function(e){t.$set(t.form,"grade",e)},expression:"form.grade"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"礼品编号"}},[i("el-input",{model:{value:t.form.code,callback:function(e){t.$set(t.form,"code",e)},expression:"form.code"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"礼品名称"}},[i("el-input",{model:{value:t.form.prize_name,callback:function(e){t.$set(t.form,"prize_name",e)},expression:"form.prize_name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"中奖权重"}},[i("el-input",{model:{value:t.form.probability,callback:function(e){t.$set(t.form,"probability",e)},expression:"form.probability"}})],1)],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{on:{click:t.dialogConfirm}},[t._v("确定")])],1)],1)],1)},[],!1,null,"48be46e0",null);c.options.__file="index.vue";e.default=c.exports}}]);