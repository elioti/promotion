(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3025"],{BbXu:function(e,t,i){"use strict";var r=i("nffF");i.n(r).a},ip1P:function(e,t,i){"use strict";i.r(t);var r=i("FyfS"),n=i.n(r),o=i("P2sY"),a=i.n(o),l=i("t3Un");var s={name:"Prize",filters:{toPer:function(e){if(0===e)return 0;var t=Number(100*e).toFixed(2);return t+="%"}},data:function(){return{prizes:null,prizeLoading:!0,titleMap:{addPrize:"新增礼品",editPrize:"编辑礼品"},dialogStatus:"",dialogFormVisible:!1,form:{code:"",prize_name:"",probability:""}}},computed:{totalProb:function(){var e=0;return this.prizes.forEach(function(t,i,r){e+=parseFloat(t.probability)}),e}},created:function(){this.fetchPrizes()},methods:{fetchPrizes:function(){var e=this;this.prizeLoading=!0,function(e){return Object(l.a)({url:"/api/prizes/",params:e})}().then(function(t){e.prizes=t.data.results}),this.prizeLoading=!1},addPrize:function(){this.dialogFormVisible=!0,this.dialogStatus="addPrize",this.form={code:"",prize_name:"",probability:""}},deletePrize:function(e){var t=this;(function(e){return Object(l.a)({url:"/api/prizes/"+e+"/",method:"delete"})})(e.id).then(function(){t.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}),t.prizes.splice(e.$index,1)})},editPrize:function(e){this.form=a()({},e),this.dialogFormVisible=!0,this.dialogStatus="editPrize"},dialogConfirm:function(){var e=this;if("editPrize"===this.dialogStatus){var t=a()({},this.form);(function(e,t){return Object(l.a)({url:"/api/prizes/"+e+"/",method:"patch",data:t})})(t.id,t).then(function(){var t=!0,i=!1,r=void 0;try{for(var o,a=n()(e.prizes);!(t=(o=a.next()).done);t=!0){var l=o.value;if(l.id===e.form.id){var s=e.prizes.indexOf(l);e.prizes.splice(s,1,e.form);break}}}catch(e){i=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw r}}e.dialogFormVisible=!1,e.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3})})}else(function(e){return Object(l.a)({url:"/api/prizes/",method:"post",data:e})})(this.form).then(function(t){e.prizes.push(t.data),e.dialogFormVisible=!1,e.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3})})}}},u=(i("BbXu"),i("KHd+")),c=Object(u.a)(s,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("el-button",{attrs:{type:"success"},on:{click:e.addPrize}},[e._v("添加礼品")]),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.prizeLoading,expression:"prizeLoading"}],staticStyle:{"margin-top":"20px"},attrs:{data:e.prizes,"element-loading-text":"获取中",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",label:"礼品编号","min-width":"12.5%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.code)+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"礼品名称","min-width":"37.5%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.prize_name)+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"中奖权重","min-width":"12.5%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.probability)+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"中奖率","min-width":"12.5%",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("toPer")(t.row.probability/e.totalProb))+"\n      ")]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",label:"操作","min-width":"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"primary"},on:{click:function(i){e.editPrize(t.row)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{type:"danger"},on:{click:function(i){e.deletePrize(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),i("el-dialog",{attrs:{title:e.titleMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{attrs:{model:e.form}},[i("el-form-item",{attrs:{label:"礼品编号"}},[i("el-input",{model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"礼品名称"}},[i("el-input",{model:{value:e.form.prize_name,callback:function(t){e.$set(e.form,"prize_name",t)},expression:"form.prize_name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"中奖权重"}},[i("el-input",{model:{value:e.form.probability,callback:function(t){e.$set(e.form,"probability",t)},expression:"form.probability"}})],1)],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{on:{click:e.dialogConfirm}},[e._v("确定")])],1)],1)],1)},[],!1,null,"09bfffa7",null);c.options.__file="index.vue";t.default=c.exports},nffF:function(e,t,i){}}]);